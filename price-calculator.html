<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¯”åƒ¹è¨ˆç®—å™¨ | Widget å·¥å…·é›†</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body class="page-price">
    <div class="container">
        <div class="header">
            <h1>ğŸ›’ æ¯”åƒ¹è¨ˆç®—å™¨</h1>
            <div class="subtitle">æ¯”è¼ƒä¸åŒç”¢å“çš„å–®ä½åƒ¹æ ¼ï¼Œæ‰¾å‡ºæœ€åˆ’ç®—çš„é¸æ“‡</div>
        </div>

        <div class="main-content">
            <!-- æ–°å¢ç”¢å“å€åŸŸ -->
            <div class="add-section">
                <h2>â• æ–°å¢ç”¢å“</h2>
                <form id="productForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="productName">ç”¢å“åç¨±</label>
                            <input type="text" id="productName" placeholder="ä¾‹å¦‚ï¼šå¥½å¸‚å¤šç‰›å¥¶" required>
                        </div>
                        <div class="form-group">
                            <label for="price">å”®åƒ¹</label>
                            <input type="number" id="price" step="0.01" min="0" placeholder="89" required>
                        </div>
                        <div class="form-group">
                            <label for="quantity">æ•¸é‡</label>
                            <input type="number" id="quantity" step="0.01" min="0" placeholder="1000" required>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                            <div class="form-group">
                                <label for="unitType">å–®ä½é¡å‹</label>
                                <select id="unitType" required onchange="updateUnitOptions()">
                                    <option value="">é¸æ“‡é¡å‹</option>
                                    <option value="volume">ğŸ§Š å®¹é‡</option>
                                    <option value="weight">âš–ï¸ é‡é‡</option>
                                    <option value="package">ğŸ“¦ åŒ…è£</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="unit">å–®ä½</label>
                                <select id="unit" required disabled>
                                    <option value="">è«‹å…ˆé¸æ“‡é¡å‹</option>
                                </select>
                            </div>
                        </div>
                        <button type="submit" class="add-btn">æ–°å¢ç”¢å“</button>
                    </div>
                </form>
            </div>

            <!-- æ¯”è¼ƒçµæœå€åŸŸ -->
            <div class="comparison-section">
                <h2>ğŸ“Š ç”¢å“æ¯”è¼ƒ</h2>
                <div id="productsContainer" class="products-grid">
                    <div class="empty-state">
                        <span class="emoji">ğŸ›ï¸</span>
                        <h3>é‚„æ²’æœ‰ç”¢å“</h3>
                        <p>æ–°å¢ä¸€äº›ç”¢å“ä¾†é–‹å§‹æ¯”åƒ¹å§ï¼</p>
                    </div>
                </div>
            </div>

            <div class="back-link">
                ğŸ”— <a href="index.html">è¿”å› Widget å·¥å…·é›†é¦–é </a>
            </div>
        </div>
    </div>

    <script>
        let products = [];
        let nextId = 1;

        // å–®ä½é¸é …å®šç¾©
        const unitOptions = {
            volume: {
                'ml': 'æ¯«å‡ (ml)',
                'l': 'å…¬å‡ (L)',
                'fl oz': 'æ¶²é«”ç›å¸ (fl oz)'
            },
            weight: {
                'g': 'å…¬å…‹ (g)',
                'kg': 'å…¬æ–¤ (kg)',
                'å°æ–¤': 'å°æ–¤',
                'å¸‚æ–¤': 'å¸‚æ–¤',
                'ç£…': 'ç£… (lb)'
            },
            package: {
                'åŒ…': 'åŒ…',
                'ç“¶': 'ç“¶',
                'ç½': 'ç½',
                'ç‰‡': 'ç‰‡',
                'å¼µ': 'å¼µ',
                'æ¢': 'æ¢'
            }
        };

        // å–®ä½æ›ç®—è¡¨ï¼ˆè½‰æ›ç‚ºæ¨™æº–å–®ä½ï¼‰
        const unitConversions = {
            // å®¹é‡ï¼ˆè½‰æ›ç‚º mlï¼‰
            'ml': 1,
            'l': 1000,
            'fl oz': 29.5735,  // 1æ¶²é«”ç›å¸ = 29.5735æ¯«å‡
            
            // é‡é‡ï¼ˆè½‰æ›ç‚º gï¼‰
            'g': 1,
            'kg': 1000,
            'å°æ–¤': 600,      // 1å°æ–¤ = 600å…¬å…‹
            'å¸‚æ–¤': 500,      // 1å¸‚æ–¤ = 500å…¬å…‹
            'ç£…': 453.592,    // 1ç£… = 453.592å…¬å…‹
            
            // åŒ…è£å–®ä½ï¼ˆç„¡æ³•æ›ç®—ï¼Œç›´æ¥æ¯”è¼ƒï¼‰
            'åŒ…': 1,
            'ç“¶': 1,
            'ç½': 1,
            'ç‰‡': 1,
            'å¼µ': 1,
            'æ¢': 1
        };

        // å–®ä½é¡å‹åˆ†çµ„
        const unitTypes = {
            'volume': ['ml', 'l', 'fl oz'],
            'weight': ['g', 'kg', 'å°æ–¤', 'å¸‚æ–¤', 'ç£…'],
            'package': ['åŒ…', 'ç“¶', 'ç½', 'ç‰‡', 'å¼µ', 'æ¢']
        };

        // ç²å–å–®ä½é¡å‹
        function getUnitType(unit) {
            for (const [type, units] of Object.entries(unitTypes)) {
                if (units.includes(unit)) return type;
            }
            return 'package';
        }

        // ç²å–æ¨™æº–å–®ä½
        function getStandardUnit(unit) {
            const type = getUnitType(unit);
            if (type === 'volume') return 'ml';
            if (type === 'weight') return 'g';
            return unit; // åŒ…è£å–®ä½ä¿æŒåŸæ¨£
        }

        // æ›´æ–°å–®ä½é¸é …
        function updateUnitOptions() {
            const unitTypeSelect = document.getElementById('unitType');
            const unitSelect = document.getElementById('unit');
            const selectedType = unitTypeSelect.value;

            // æ¸…ç©ºå–®ä½é¸é …
            unitSelect.innerHTML = '<option value="">è«‹é¸æ“‡å–®ä½</option>';
            
            if (selectedType && unitOptions[selectedType]) {
                // å•Ÿç”¨å–®ä½é¸æ“‡
                unitSelect.disabled = false;
                
                // æ·»åŠ å°æ‡‰é¡å‹çš„å–®ä½é¸é …
                for (const [value, label] of Object.entries(unitOptions[selectedType])) {
                    const option = document.createElement('option');
                    option.value = value;
                    option.textContent = label;
                    unitSelect.appendChild(option);
                }
            } else {
                // ç¦ç”¨å–®ä½é¸æ“‡
                unitSelect.disabled = true;
                unitSelect.innerHTML = '<option value="">è«‹å…ˆé¸æ“‡é¡å‹</option>';
            }
        }

        // è¡¨å–®æäº¤äº‹ä»¶
        document.getElementById('productForm').addEventListener('submit', function(e) {
            e.preventDefault();
            addProduct();
        });

        // æ–°å¢ç”¢å“
        function addProduct() {
            const name = document.getElementById('productName').value;
            const price = parseFloat(document.getElementById('price').value);
            const quantity = parseFloat(document.getElementById('quantity').value);
            const unitType = document.getElementById('unitType').value;
            const unit = document.getElementById('unit').value;

            if (!name || !price || !quantity || !unitType || !unit) {
                alert('è«‹å¡«å¯«æ‰€æœ‰å¿…è¦æ¬„ä½');
                return;
            }

            if (price <= 0 || quantity <= 0) {
                alert('å”®åƒ¹å’Œæ•¸é‡å¿…é ˆå¤§æ–¼ 0');
                return;
            }

            // è½‰æ›ç‚ºæ¨™æº–å–®ä½é€²è¡Œæ¯”è¼ƒ
            const standardQuantity = quantity * unitConversions[unit];
            const standardUnit = getStandardUnit(unit);
            
            const product = {
                id: nextId++,
                name: name,
                price: price,
                quantity: quantity,
                unit: unit,
                unitPrice: price / quantity,
                standardQuantity: standardQuantity,
                standardUnit: standardUnit,
                standardUnitPrice: price / standardQuantity,
                unitType: getUnitType(unit)
            };

            products.push(product);
            updateDisplay();
            clearForm();
        }

        // åˆªé™¤ç”¢å“
        function deleteProduct(id) {
            products = products.filter(product => product.id !== id);
            updateDisplay();
        }

        // æ›´æ–°é¡¯ç¤º
        function updateDisplay() {
            const container = document.getElementById('productsContainer');
            
            if (products.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <span class="emoji">ğŸ›ï¸</span>
                        <h3>é‚„æ²’æœ‰ç”¢å“</h3>
                        <p>æ–°å¢ä¸€äº›ç”¢å“ä¾†é–‹å§‹æ¯”åƒ¹å§ï¼</p>
                    </div>
                `;
                return;
            }

            // æŒ‰å–®ä½é¡å‹åˆ†çµ„æ¯”è¼ƒ
            const groupedProducts = groupProductsByType(products);
            let html = '';

            for (const [type, typeProducts] of Object.entries(groupedProducts)) {
                if (typeProducts.length === 0) continue;

                // æ‰¾å‡ºè©²é¡å‹ä¸­æœ€åˆ’ç®—çš„ç”¢å“
                const bestDeal = typeProducts.reduce((best, current) => {
                    if (type === 'package') {
                        return current.unitPrice < best.unitPrice ? current : best;
                    } else {
                        return current.standardUnitPrice < best.standardUnitPrice ? current : best;
                    }
                });

                const typeTitle = getTypeTitle(type);
                html += `<div style="margin-bottom: 20px;"><h3 style="color: #666; font-size: 1.1em; margin-bottom: 12px; padding-left: 5px;">${typeTitle}</h3>`;

                html += typeProducts.map(product => `
                    <div class="product-card ${product.id === bestDeal.id ? 'best-deal' : ''}">
                        <div class="product-name">${product.name}</div>
                        
                        <div class="product-details">
                            <div class="detail-item">
                                <div class="detail-label">å”®åƒ¹</div>
                                <div class="detail-value">$${product.price.toFixed(0)}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">å®¹é‡/æ•¸é‡</div>
                                <div class="detail-value">${formatQuantity(product.quantity)} ${product.unit}</div>
                            </div>
                        </div>

                        <div class="unit-price">
                            <div class="unit-price-label">å–®åƒ¹</div>
                            <div class="unit-price-value">$${product.unitPrice.toFixed(2)} / ${product.unit}</div>
                            ${type !== 'package' && product.unit !== product.standardUnit ? 
                                `<div style="font-size: 0.75em; opacity: 0.8; margin-top: 3px;">
                                    ($${product.standardUnitPrice.toFixed(3)} / ${product.standardUnit})
                                </div>` : ''
                            }
                        </div>

                        <button class="delete-btn" onclick="deleteProduct(${product.id})">
                            ğŸ—‘ï¸ åˆªé™¤
                        </button>
                    </div>
                `).join('');
                
                html += '</div>';
            }

            container.innerHTML = html;
        }

        // æŒ‰é¡å‹åˆ†çµ„ç”¢å“
        function groupProductsByType(products) {
            const groups = {
                volume: [],
                weight: [],
                package: []
            };

            products.forEach(product => {
                groups[product.unitType].push(product);
            });

            return groups;
        }

        // ç²å–é¡å‹æ¨™é¡Œ
        function getTypeTitle(type) {
            const titles = {
                volume: 'ğŸ§Š å®¹é‡é¡å•†å“',
                weight: 'âš–ï¸ é‡é‡é¡å•†å“',
                package: 'ğŸ“¦ åŒ…è£é¡å•†å“'
            };
            return titles[type] || 'å…¶ä»–å•†å“';
        }


        // æ ¼å¼åŒ–æ•¸é‡é¡¯ç¤º
        function formatQuantity(quantity) {
            if (quantity >= 1000 && quantity % 1000 === 0) {
                return (quantity / 1000).toString() + 'K';
            }
            return quantity % 1 === 0 ? quantity.toString() : quantity.toFixed(2);
        }

        // æ¸…ç©ºè¡¨å–®
        function clearForm() {
            document.getElementById('productName').value = '';
            document.getElementById('price').value = '';
            document.getElementById('quantity').value = '';
            document.getElementById('unitType').value = '';
            document.getElementById('unit').value = '';
            document.getElementById('unit').disabled = true;
            document.getElementById('unit').innerHTML = '<option value="">è«‹å…ˆé¸æ“‡é¡å‹</option>';
        }

        // è¼¸å…¥é©—è­‰
        document.getElementById('price').addEventListener('input', function() {
            if (this.value < 0) this.value = 0;
        });

        document.getElementById('quantity').addEventListener('input', function() {
            if (this.value < 0) this.value = 0;
        });
    </script>
</body>
</html>