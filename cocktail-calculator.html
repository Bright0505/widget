<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èª¿é…’è¨ˆç®—å™¨ | Widget å·¥å…·é›†</title>
    <link rel="stylesheet" href="styles-bw.css">
</head>
<body class="page-cocktail">
    <div class="container">
        <h1>ğŸ¸ èª¿é…’è¨ˆç®—å™¨</h1>
        
        <div class="mode-selector">
            <button type="button" class="mode-btn active" onclick="switchMode('mixing')">èª¿é…’è¨ˆç®—</button>
            <button type="button" class="mode-btn" onclick="switchMode('bac')">è¡€æ¶²æ¿ƒåº¦</button>
        </div>

        <!-- èª¿é…’è¨ˆç®—æ¨¡å¼ -->
        <div id="mixingMode" class="calculator-mode active">
            <form id="mixingForm">
                <div class="form-group">
                    <label for="targetConcentration">ç›®æ¨™é…’ç²¾æ¿ƒåº¦</label>
                    <input type="number" id="targetConcentration" step="0.1" min="0" max="100" required>
                    <div class="unit">å–®ä½ï¼šç™¾åˆ†æ¯” (%) - ä¾‹å¦‚ï¼š9%</div>
                </div>

                <div class="form-group">
                    <label for="totalVolume">ç¸½æ¶²é«”é‡</label>
                    <input type="number" id="totalVolume" step="0.1" min="0" required>
                    <div class="unit">å–®ä½ï¼šæ¯«å‡ (ml) - ä¾‹å¦‚ï¼š250ml</div>
                </div>

                <div class="form-group">
                    <label for="alcoholConcentration">ä½¿ç”¨é…’ç²¾æ¿ƒåº¦</label>
                    <input type="number" id="alcoholConcentration" step="0.1" min="0" max="100" value="40" required>
                    <div class="unit">å–®ä½ï¼šç™¾åˆ†æ¯” (%) - ä¾‹å¦‚ï¼š40% ä¼ç‰¹åŠ </div>
                </div>

                <button type="submit">ğŸ¸ è¨ˆç®—éœ€è¦å¤šå°‘é…’ç²¾</button>
            </form>

            <div id="mixingResult" class="result">
                <h3>ğŸ¹ èª¿é…’é…æ–¹</h3>
                <div id="mixingCalculation"></div>
            </div>
        </div>

        <!-- è¡€æ¶²æ¿ƒåº¦è¨ˆç®—æ¨¡å¼ -->
        <div id="bacMode" class="calculator-mode">
            <form id="bacForm">
                <div class="form-group">
                    <label for="alcoholVolume">é…’ç²¾é£²æ–™å®¹é‡</label>
                    <input type="number" id="alcoholVolume" step="0.1" min="0" required>
                    <div class="unit">å–®ä½ï¼šæ¯«å‡ (ml)</div>
                </div>

                <div class="form-group">
                    <label for="alcoholPercentage">é…’ç²¾æ¿ƒåº¦</label>
                    <input type="number" id="alcoholPercentage" step="0.1" min="0" max="100" required>
                    <div class="unit">å–®ä½ï¼šç™¾åˆ†æ¯” (%)</div>
                </div>

                <div class="form-group">
                    <label for="bodyWeight">é«”é‡</label>
                    <input type="number" id="bodyWeight" step="0.1" min="0" required>
                    <div class="unit">å–®ä½ï¼šå…¬æ–¤ (kg)</div>
                </div>

                <div class="form-group">
                    <label for="gender">æ€§åˆ¥</label>
                    <select id="gender">
                        <option value="male">ç”·æ€§</option>
                        <option value="female">å¥³æ€§</option>
                    </select>
                </div>

                <button type="submit">è¨ˆç®—è¡€æ¶²é…’ç²¾æ¿ƒåº¦</button>
            </form>

            <div id="bacResult" class="result">
                <h3>è¡€æ¶²é…’ç²¾æ¿ƒåº¦ (BAC)</h3>
                <div class="bac-value" id="bacValue">0.00%</div>
                <div id="statusMessage"></div>
            </div>
        </div>

        <div class="note">
            âš ï¸ æ­¤è¨ˆç®—å™¨åƒ…ä¾›åƒè€ƒï¼Œå¯¦éš›é…’ç²¾æ¿ƒåº¦å—å¤šç¨®å› ç´ å½±éŸ¿ã€‚è«‹å‹¿é…’é§•ï¼Œçæ„›ç”Ÿå‘½ã€‚<br>
            ğŸ”— <a href="index.html" style="color: #667eea; text-decoration: none;">è¿”å› Widget å·¥å…·é›†é¦–é </a>
        </div>
    </div>

    <script>
        // æ¨¡å¼åˆ‡æ›
        function switchMode(mode) {
            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            // æ›´æ–°é¡¯ç¤ºæ¨¡å¼
            document.querySelectorAll('.calculator-mode').forEach(div => div.classList.remove('active'));
            if (mode === 'mixing') {
                document.getElementById('mixingMode').classList.add('active');
            } else {
                document.getElementById('bacMode').classList.add('active');
            }
        }

        // èª¿é…è¨ˆç®—è¡¨å–®äº‹ä»¶
        document.getElementById('mixingForm').addEventListener('submit', function(e) {
            e.preventDefault();
            calculateMixing();
        });

        // è¡€æ¶²æ¿ƒåº¦è¨ˆç®—è¡¨å–®äº‹ä»¶
        document.getElementById('bacForm').addEventListener('submit', function(e) {
            e.preventDefault();
            calculateBAC();
        });

        // èª¿é…’è¨ˆç®—åŠŸèƒ½
        function calculateMixing() {
            const targetConcentration = parseFloat(document.getElementById('targetConcentration').value);
            const totalVolume = parseFloat(document.getElementById('totalVolume').value);
            const alcoholConcentration = parseFloat(document.getElementById('alcoholConcentration').value);

            if (isNaN(targetConcentration) || isNaN(totalVolume) || isNaN(alcoholConcentration)) {
                alert('è«‹å¡«å¯«æ‰€æœ‰å¿…è¦æ¬„ä½');
                return;
            }

            if (targetConcentration > alcoholConcentration) {
                alert('ç›®æ¨™æ¿ƒåº¦ä¸èƒ½é«˜æ–¼ä½¿ç”¨çš„é…’ç²¾æ¿ƒåº¦');
                return;
            }

            if (targetConcentration <= 0) {
                alert('ç›®æ¨™æ¿ƒåº¦å¿…é ˆå¤§æ–¼ 0');
                return;
            }

            if (totalVolume <= 0) {
                alert('ç¸½æ¶²é«”é‡å¿…é ˆå¤§æ–¼ 0');
                return;
            }

            // è¨ˆç®—éœ€è¦çš„é…’ç²¾å®¹é‡
            // å…¬å¼ï¼šé…’ç²¾å®¹é‡ = (ç›®æ¨™æ¿ƒåº¦ Ã— ç¸½å®¹é‡) Ã· é…’ç²¾æ¿ƒåº¦
            const alcoholVolumeRaw = (targetConcentration * totalVolume) / alcoholConcentration;
            
            // æ™ºèƒ½å››æ¨äº”å…¥ - å„ªå…ˆé¡¯ç¤ºä»¥ 0 æˆ– 5 çµå°¾çš„æ•´æ•¸
            function smartRound(value) {
                const rounded = Math.round(value);
                const rounded5 = Math.round(value / 5) * 5;
                const rounded10 = Math.round(value / 10) * 10;
                
                // å¦‚æœåŸå€¼å’Œ10çš„å€æ•¸å·®è·åœ¨5%ä»¥å…§ï¼Œå„ªå…ˆé¡¯ç¤º10çš„å€æ•¸
                if (Math.abs(value - rounded10) / value <= 0.05) {
                    return rounded10;
                }
                // å¦‚æœåŸå€¼å’Œ5çš„å€æ•¸å·®è·åœ¨3%ä»¥å…§ï¼Œé¡¯ç¤º5çš„å€æ•¸
                else if (Math.abs(value - rounded5) / value <= 0.03) {
                    return rounded5;
                }
                // å¦å‰‡é¡¯ç¤ºå››æ¨äº”å…¥çš„æ•´æ•¸
                else {
                    return rounded;
                }
            }
            
            const alcoholVolume = smartRound(alcoholVolumeRaw);
            const nonAlcoholVolume = totalVolume - alcoholVolume;

            // é©—è­‰çµæœ
            if (alcoholVolume > totalVolume) {
                alert('ç„¡æ³•é”æˆç›®æ¨™æ¿ƒåº¦ï¼Œé…’ç²¾ç”¨é‡è¶…éç¸½å®¹é‡');
                return;
            }

            if (alcoholVolume < 0 || nonAlcoholVolume < 0) {
                alert('è¨ˆç®—çµæœç„¡æ•ˆï¼Œè«‹æª¢æŸ¥è¼¸å…¥æ•¸å€¼');
                return;
            }

            // è¨ˆç®—å¯¦éš›é”æˆçš„æ¿ƒåº¦ï¼ˆåŸºæ–¼èª¿æ•´å¾Œçš„é…’ç²¾ç”¨é‡ï¼‰
            const actualConcentration = (alcoholVolume * alcoholConcentration) / totalVolume;

            // é¡¯ç¤ºçµæœ
            const resultDiv = document.getElementById('mixingCalculation');
            resultDiv.innerHTML = `
                <div style="background: linear-gradient(135deg, #ff6b6b 0%, #ffa726 100%); padding: 20px; border-radius: 15px; margin: 15px 0; color: white;">
                    <h4 style="color: white; margin-bottom: 20px; text-align: center;">ğŸ¹ å®Œç¾èª¿é…’é…æ–¹</h4>
                    
                    <!-- ä¸»è¦çµæœ - é…’ç²¾ç”¨é‡ -->
                    <div style="background: rgba(255,255,255,0.95); padding: 25px; border-radius: 12px; margin-bottom: 20px; color: #333;">
                        <div style="text-align: center;">
                            <div style="font-size: 1.2em; color: #666; margin-bottom: 8px;">ğŸ¥ƒ éœ€è¦é…’ç²¾ (${alcoholConcentration}%)</div>
                            <div style="font-size: 3em; font-weight: 700; color: #ff6b6b; margin: 10px 0;">${alcoholVolume} ml</div>
                            <div style="color: #888; font-size: 0.9em;">ç´„ ${((alcoholVolume / totalVolume) * 100).toFixed(0)}% æ¯”ä¾‹</div>
                            ${Math.abs(alcoholVolumeRaw - alcoholVolume) > 0.5 ? 
                                `<div style="background: #fff3cd; padding: 8px; border-radius: 6px; margin-top: 10px; color: #856404; font-size: 0.85em;">
                                    ğŸ’¡ ç‚ºä¾¿æ–¼æ¸¬é‡å·²èª¿æ•´ç‚º ${alcoholVolume}ml (åŸè¨ˆç®—å€¼: ${alcoholVolumeRaw.toFixed(1)}ml)
                                </div>` : ''
                            }
                        </div>
                    </div>

                    <!-- è©³ç´°é…æ–¹ -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                        <div style="background: rgba(255,255,255,0.9); padding: 18px; border-radius: 10px; color: #333; text-align: center;">
                            <div style="font-size: 1.5em; margin-bottom: 8px;">ğŸº</div>
                            <div style="font-weight: 600; margin-bottom: 5px;">é…’ç²¾ (${alcoholConcentration}%)</div>
                            <div style="font-size: 1.4em; font-weight: 700; color: #ff6b6b;">${alcoholVolume} ml</div>
                        </div>
                        <div style="background: rgba(255,255,255,0.9); padding: 18px; border-radius: 10px; color: #333; text-align: center;">
                            <div style="font-size: 1.5em; margin-bottom: 8px;">ğŸ§Š</div>
                            <div style="font-weight: 600; margin-bottom: 5px;">å…¶ä»–æ¶²é«”</div>
                            <div style="font-size: 1.4em; font-weight: 700; color: #42a5f5;">${nonAlcoholVolume} ml</div>
                        </div>
                    </div>

                    <!-- æœ€çµ‚çµæœå¡ç‰‡ -->
                    <div style="background: rgba(255,255,255,0.95); padding: 20px; border-radius: 12px; text-align: center; color: #333;">
                        <div style="font-size: 1.1em; color: #666; margin-bottom: 8px;">ğŸ¯ èª¿é…’çµæœ</div>
                        <div style="font-weight: 700; font-size: 1.3em; color: #333;">
                            ç¸½å®¹é‡: ${totalVolume} ml | å¯¦éš›æ¿ƒåº¦: ${actualConcentration.toFixed(1)}%
                            ${Math.abs(actualConcentration - targetConcentration) > 0.1 ? 
                                ` (ç›®æ¨™: ${targetConcentration}%)` : ''
                            }
                        </div>
                        <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #eee; color: #666; font-size: 0.9em;">
                            ç´”é…’ç²¾å«é‡: ${(alcoholVolume * alcoholConcentration / 100).toFixed(0)} ml
                        </div>
                    </div>

                    <!-- èª¿é…’æç¤º -->
                    <div style="background: rgba(76, 175, 80, 0.1); padding: 15px; border-radius: 10px; margin-top: 20px; border-left: 4px solid #4caf50;">
                        <div style="font-size: 0.95em; color: white; line-height: 1.4;">
                            ğŸ¸ <strong>èª¿é…’æŠ€å·§ï¼š</strong><br>
                            1. å…ˆåŠ å…¥ ${alcoholVolume}ml çš„ ${alcoholConcentration}% é…’ç²¾<br>
                            2. å†åŠ å…¥ ${nonAlcoholVolume}ml çš„æœæ±ã€æ±½æ°´æˆ–å…¶ä»–èª¿æ–™<br>
                            3. æ”ªæ‹Œå‡å‹»ï¼Œäº«å— ${actualConcentration.toFixed(1)}% çš„å®Œç¾èª¿é…’ï¼
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('mixingResult').classList.add('show');
        }

        // è¡€æ¶²æ¿ƒåº¦è¨ˆç®—åŠŸèƒ½
        function calculateBAC() {
            const alcoholVolume = parseFloat(document.getElementById('alcoholVolume').value);
            const alcoholPercentage = parseFloat(document.getElementById('alcoholPercentage').value);
            const bodyWeight = parseFloat(document.getElementById('bodyWeight').value);
            const gender = document.getElementById('gender').value;

            if (!alcoholVolume || !alcoholPercentage || !bodyWeight) {
                alert('è«‹å¡«å¯«æ‰€æœ‰å¿…è¦æ¬„ä½');
                return;
            }

            // è¨ˆç®—ç´”é…’ç²¾é‡é‡ (å…‹)
            const pureAlcoholWeight = (alcoholVolume * alcoholPercentage / 100) * 0.789;

            // æ°´åˆ†åˆ†å¸ƒä¿‚æ•¸ (Widmark coefficient)
            const widmarkCoefficient = gender === 'male' ? 0.68 : 0.55;

            // è¨ˆç®— BAC (è¡€æ¶²é…’ç²¾æ¿ƒåº¦)
            const bac = (pureAlcoholWeight / (bodyWeight * widmarkCoefficient)) * 100;

            // é¡¯ç¤ºçµæœ
            document.getElementById('bacValue').textContent = bac.toFixed(3) + '%';
            
            const statusMessage = document.getElementById('statusMessage');
            let messageClass = '';
            let message = '';

            if (bac < 0.05) {
                messageClass = 'safe';
                message = 'âœ… è¡€æ¶²é…’ç²¾æ¿ƒåº¦è¼ƒä½ï¼Œä½†ä»å»ºè­°é¿å…é§•é§›';
            } else if (bac < 0.08) {
                messageClass = 'warning';
                message = 'âš ï¸ å·²é”æ³•å¾‹ç¦æ­¢é§•é§›æ¨™æº– (0.05%)ï¼Œçµ•å°ä¸å¯é§•é§›';
            } else if (bac < 0.25) {
                messageClass = 'danger';
                message = 'ğŸš¨ è¡€æ¶²é…’ç²¾æ¿ƒåº¦éé«˜ï¼Œå¯èƒ½å‡ºç¾åš´é‡é†‰é…’ç—‡ç‹€';
            } else {
                messageClass = 'danger';
                message = 'ğŸ†˜ è¡€æ¶²é…’ç²¾æ¿ƒåº¦æ¥µé«˜ï¼Œæœ‰ç”Ÿå‘½å±éšªï¼Œè«‹ç«‹å³å°±é†«';
            }

            statusMessage.className = messageClass;
            statusMessage.textContent = message;

            document.getElementById('bacResult').classList.add('show');
        }

        // æ·»åŠ è¼¸å…¥é©—è­‰
        document.getElementById('alcoholPercentage').addEventListener('input', function() {
            if (this.value > 100) this.value = 100;
        });

        document.getElementById('targetConcentration').addEventListener('input', function() {
            if (this.value > 100) this.value = 100;
        });

        document.getElementById('alcoholConcentration').addEventListener('input', function() {
            if (this.value > 100) this.value = 100;
        });
    </script>
</body>
</html>